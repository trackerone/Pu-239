<?php
if(!defined('MYSQL_COMPAT_LOADED'))define('MYSQL_COMPAT_LOADED',true);
class MysqlCompat{private static $pdo;static function connect($h,$u,$p,$db=null,$ch='utf8mb4'){self::$pdo=new PDO('mysql:host='.$h.($db?';dbname='.$db:'' ).';charset='.$ch,$u,$p,[PDO::ATTR_ERRMODE=>PDO::ERRMODE_EXCEPTION,PDO::ATTR_DEFAULT_FETCH_MODE=>PDO::FETCH_ASSOC,PDO::ATTR_EMULATE_PREPARES=>false,PDO::MYSQL_ATTR_USE_BUFFERED_QUERY=>true]);self::$pdo->exec("SET NAMES '$ch'");return true;}static function selectDb($db){$info=self::$pdo->getAttribute(PDO::ATTR_CONNECTION_STATUS);}static function pdo(){return self::$pdo;}}
function mysql_connect($h='localhost',$u=null,$p=null){return MysqlCompat::connect($h,$u,$p);}function mysql_pconnect($h='localhost',$u=null,$p=null){return MysqlCompat::connect($h,$u,$p);}function mysql_select_db($db){return MysqlCompat::selectDb($db);}function mysql_query($sql){$pdo=MysqlCompat::pdo();$t=ltrim($sql);if(stripos($t,'select')===0||stripos($t,'show')===0||stripos($t,'describe')===0)return $pdo->query($sql);return $pdo->exec($sql);}function mysql_fetch_assoc($r){return $r instanceof PDOStatement?($r->fetch(PDO::FETCH_ASSOC)?:false):false;}function mysql_fetch_array($r,$t=PDO::FETCH_BOTH){return $r instanceof PDOStatement?($r->fetch($t)?:false):false;}function mysql_fetch_row($r){return $r instanceof PDOStatement?($r->fetch(PDO::FETCH_NUM)?:false):false;}function mysql_num_rows($r){return $r instanceof PDOStatement?($r->rowCount()?:0):0;}function mysql_real_escape_string($s){$q=MysqlCompat::pdo()->quote($s);return ($q&&strlen($q)>=2&&$q[0]=="'"&&substr($q,-1)=="'")?substr($q,1,-1):$s;}function mysql_insert_id(){return MysqlCompat::pdo()->lastInsertId();}
